import{a as F,b as W}from"./chunk-UR74UJFY.js";import{b as O,f as Q,g as G}from"./chunk-KSVBKDBG.js";import{$a as C,Bb as h,Eb as P,Ga as j,Jb as J,P as I,Qa as E,Ra as D,Ta as N,U as y,Ua as A,V as w,W as R,X as V,Za as o,_a as i,ab as $,bb as Y,fa as L,fb as k,ga as M,gb as b,kb as H,lb as K,ob as T,pb as c,qb as f,rb as _,sb as q,va as u,za as B}from"./chunk-U5O3G23B.js";var X=["barChart"],ee=["typeChart"],te=["elevChart"],ae=["durationChart"],ne=(m,t)=>t.key,re=(m,t)=>t.label;function ie(m,t){if(m&1){let e=$();o(0,"button",13),k("click",function(){let n=y(e).$implicit,r=b();return w(r.selectPeriod(n.key))}),c(1),i()}if(m&2){let e=t.$implicit,a=b();T(a.selectedPeriod()===e.key?"bg-strava text-white rounded-lg px-4 py-2 text-sm font-semibold shadow-md":"text-slate-500 hover:text-slate-800 hover:bg-slate-100 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-200"),u(),_(" ",e.label," ")}}function oe(m,t){if(m&1){let e=$();o(0,"button",21),k("click",function(){y(e);let n=b(2);return w(n.offset.set(0))}),c(1," Aujourd'hui "),i()}}function de(m,t){if(m&1){let e=$();o(0,"div",9)(1,"button",14),k("click",function(){y(e);let n=b();return w(n.offset.set(n.offset()-1))}),R(),o(2,"svg",15),C(3,"path",16),i()(),V(),o(4,"button",17),k("click",function(){y(e);let n=b();return w(n.offset.set(0))}),c(5),i(),o(6,"button",18),k("click",function(){y(e);let n=b();return w(n.offset.set(n.offset()+1))}),R(),o(7,"svg",15),C(8,"path",19),i()(),E(9,oe,2,0,"button",20),i()}if(m&2){let e=b();u(4),T(e.offset()===0?"text-strava bg-strava/10":"text-slate-600 hover:bg-white hover:shadow-sm cursor-pointer"),u(),_(" ",e.periodLabel()," "),u(),T(e.offset()>=0?"text-slate-200 cursor-not-allowed":"text-slate-400 hover:text-slate-700 hover:bg-white hover:shadow-sm"),Y("disabled",e.offset()>=0),u(3),D(e.offset()!==0?9:-1)}}function le(m,t){if(m&1&&(o(0,"p",10),c(1),i()),m&2){let e=b();u(),f(e.periodLabel())}}function se(m,t){m&1&&(o(0,"div",11),C(1,"div",22),o(2,"p",23),c(3,"Chargement des donn\xE9es..."),i()())}function me(m,t){if(m&1&&(o(0,"div",12),c(1),i()),m&2){let e=b();u(),_(" ",e.strava.error()," ")}}function ce(m,t){m&1&&(o(0,"span",42),c(1,"p\xE9riode en cours"),i())}function ue(m,t){if(m&1&&(o(0,"div",44)(1,"span",45),c(2),i(),o(3,"span",46),c(4),i()()),m&2){let e=t.$implicit;u(2),f(e.label),u(),T(e.pct>=0?"text-emerald-700 bg-emerald-100":"text-red-700 bg-red-100"),u(),q(" ",e.pct>=0?"+":"","",e.pct,"% ")}}function pe(m,t){if(m&1&&(o(0,"div",34)(1,"div",40)(2,"span",41),c(3),i(),E(4,ce,2,0,"span",42),i(),o(5,"div",43),N(6,ue,5,5,"div",44,re),i()()),m&2){let e=b(2);u(3),f(e.comparisonLabel()),u(),D(e.isCurrentPeriod()?4:-1),u(2),A(e.comparison())}}function he(m,t){if(m&1&&(o(0,"div",24)(1,"div",25)(2,"p",26),c(3,"Activit\xE9s"),i(),o(4,"p",27),c(5),i()(),o(6,"div",28)(7,"p",26),c(8,"Distance"),i(),o(9,"p",27),c(10),o(11,"span",29),c(12,"km"),i()()(),o(13,"div",30)(14,"p",26),c(15,"D\xE9nivel\xE9"),i(),o(16,"p",27),c(17),o(18,"span",29),c(19,"m"),i()()(),o(20,"div",31)(21,"p",26),c(22,"Dur\xE9e"),i(),o(23,"p",27),c(24),i()(),o(25,"div",32)(26,"p",26),c(27,"Moy. / sortie"),i(),o(28,"p",27),c(29),o(30,"span",29),c(31,"km"),i()()(),o(32,"div",33)(33,"p",26),c(34,"Fr\xE9quence"),i(),o(35,"p",27),c(36),i()()(),E(37,pe,8,2,"div",34),o(38,"div",35)(39,"div",36)(40,"h2",37),c(41),i(),C(42,"canvas",null,0),i(),o(44,"div",38)(45,"h2",37),c(46,"R\xE9partition par type"),i(),C(47,"canvas",null,1),i()(),o(49,"div",39)(50,"div",38)(51,"h2",37),c(52),i(),C(53,"canvas",null,2),i(),o(55,"div",38)(56,"h2",37),c(57),i(),C(58,"canvas",null,3),i()()),m&2){let e=b();u(5),f(e.stats().count),u(5),_("",e.stats().distanceKm," "),u(7),_("",e.stats().elevation," "),u(7),f(e.stats().duration),u(5),_("",e.stats().avgDistanceKm," "),u(7),f(e.stats().frequency),u(),D(e.selectedPeriod()!=="all"&&e.comparison()?37:-1),u(4),f(e.barChartTitle()),u(11),f(e.elevChartTitle()),u(5),f(e.durationChartTitle())}}F.register(...W);var z=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],U=["Jan","F\xE9v","Mar","Avr","Mai","Juin","Juil","Ao\xFBt","Sep","Oct","Nov","D\xE9c"],Z=class m{strava=I(J);selectedPeriod=L("month");offset=L(0);periods=[{key:"week",label:"Semaine"},{key:"month",label:"Mois"},{key:"year",label:"Ann\xE9e"},{key:"all",label:"Tout"}];barCanvas=P("barChart");typeCanvas=P("typeChart");elevCanvas=P("elevChart");durationCanvas=P("durationChart");barChart=null;typeChart=null;elevChart=null;durationChart=null;selectPeriod(t){this.selectedPeriod.set(t),this.offset.set(0)}periodRange=h(()=>this.computePeriodRange(this.selectedPeriod(),this.offset()));computePeriodRange(t,e){let a=new Date;if(t==="all")return{start:null,end:null};let n,r;if(t==="week"){n=new Date(a);let d=n.getDay();n.setDate(n.getDate()-(d===0?6:d-1)+e*7),n.setHours(0,0,0,0),r=new Date(n),r.setDate(r.getDate()+6),r.setHours(23,59,59,999)}else t==="month"?(n=new Date(a.getFullYear(),a.getMonth()+e,1),r=new Date(a.getFullYear(),a.getMonth()+e+1,0,23,59,59,999)):(n=new Date(a.getFullYear()+e,0,1),r=new Date(a.getFullYear()+e,11,31,23,59,59,999));return{start:n,end:r}}filtered=h(()=>{let t=this.strava.activities(),{start:e,end:a}=this.periodRange();return!e||!a?t:t.filter(n=>{let r=new Date(n.start_date);return r>=e&&r<=a})});stats=h(()=>{let t=this.filtered(),e=t.length,a=t.reduce((l,p)=>l+p.distance,0),n=t.reduce((l,p)=>l+p.total_elevation_gain,0),r=t.reduce((l,p)=>l+p.moving_time,0),d=this.selectedPeriod(),s;if(e===0)s="-";else if(d==="week")s=`${e}/sem`;else if(d==="all"){let l=new Date(t[t.length-1].start_date),p=Math.max(1,Math.ceil((Date.now()-l.getTime())/(7*864e5)));s=`${Math.round(e/p*10)/10}/sem`}else{let l=this.periodRange(),p=l.end&&l.end<new Date?l.end:new Date,x=Math.max(1,Math.ceil((p.getTime()-l.start.getTime())/(7*864e5)));s=`${Math.round(e/x*10)/10}/sem`}return{count:e,distanceKm:Math.round(a/1e3),elevation:Math.round(n),duration:O(r),avgDistanceKm:e>0?(a/e/1e3).toFixed(1):"0",frequency:s}});previousFiltered=h(()=>{let t=this.selectedPeriod();if(t==="all")return[];let e=this.strava.activities(),{start:a,end:n}=this.computePeriodRange(t,this.offset()-1);return!a||!n?[]:e.filter(r=>{let d=new Date(r.start_date);return d>=a&&d<=n})});comparisonLabel=h(()=>{let t=this.selectedPeriod();if(t==="all")return"";let e=this.computePeriodRange(t,this.offset()-1);if(!e.start)return"";let a=e.start;if(t==="week"){let n=e.end,r=d=>d.toLocaleDateString("fr-FR",{day:"numeric",month:"short"});return`vs semaine du ${r(a)} au ${r(n)}`}return t==="month"?`vs ${a.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})}`:`vs ${a.getFullYear()}`});isCurrentPeriod=h(()=>this.offset()===0&&this.selectedPeriod()!=="all");comparison=h(()=>{if(this.selectedPeriod()==="all")return null;let t=this.filtered(),e=this.previousFiltered();if(e.length===0)return null;let a=(g,v)=>v===0?0:Math.round((g-v)/v*100),n=t.reduce((g,v)=>g+v.distance,0),r=e.reduce((g,v)=>g+v.distance,0),d=t.reduce((g,v)=>g+v.total_elevation_gain,0),s=e.reduce((g,v)=>g+v.total_elevation_gain,0),l=t.reduce((g,v)=>g+v.moving_time,0),p=e.reduce((g,v)=>g+v.moving_time,0),x=t.length>0?n/t.length:0,S=e.length>0?r/e.length:0;return[{label:"Activit\xE9s",pct:a(t.length,e.length)},{label:"Distance",pct:a(n,r)},{label:"D\xE9nivel\xE9",pct:a(d,s)},{label:"Dur\xE9e",pct:a(l,p)},{label:"Moy/sortie",pct:a(x,S)}]});periodLabel=h(()=>{let t=this.periodRange(),e=this.selectedPeriod();if(e==="all")return"Toutes les activit\xE9s";let a=t.start;if(e==="week"){let n=t.end,r=d=>d.toLocaleDateString("fr-FR",{day:"numeric",month:"short"});return`Semaine du ${r(a)} au ${r(n)}`}return e==="month"?a.toLocaleDateString("fr-FR",{month:"long",year:"numeric"}):`Ann\xE9e ${a.getFullYear()}`});barChartTitle=h(()=>{switch(this.selectedPeriod()){case"week":return"Kilom\xE8tres par jour";case"month":return"Kilom\xE8tres par jour";case"year":return"Kilom\xE8tres par mois";case"all":return"Kilom\xE8tres par ann\xE9e"}});elevChartTitle=h(()=>{switch(this.selectedPeriod()){case"week":return"D\xE9nivel\xE9 par jour (m)";case"month":return"D\xE9nivel\xE9 par jour (m)";case"year":return"D\xE9nivel\xE9 par mois (m)";case"all":return"D\xE9nivel\xE9 par ann\xE9e (m)"}});durationChartTitle=h(()=>{switch(this.selectedPeriod()){case"week":return"Dur\xE9e par jour (min)";case"month":return"Dur\xE9e par jour (min)";case"year":return"Dur\xE9e par mois (h)";case"all":return"Dur\xE9e par ann\xE9e (h)"}});barData=h(()=>this.computeBarData(this.filtered(),this.selectedPeriod(),"distance"));elevData=h(()=>this.computeBarData(this.filtered(),this.selectedPeriod(),"elevation"));durationData=h(()=>this.computeBarData(this.filtered(),this.selectedPeriod(),"duration"));typeData=h(()=>this.computeTypeDistribution(this.filtered()));constructor(){B(()=>{this.strava.loadAllActivities()}),M(()=>{this.renderBar(this.barCanvas(),this.barData(),"bar","#f97316","km")}),M(()=>{this.renderBar(this.elevCanvas(),this.elevData(),"elev","#22c55e","m")}),M(()=>{let t=this.selectedPeriod(),e=t==="week"||t==="month"?"min":"h";this.renderBar(this.durationCanvas(),this.durationData(),"duration","#8b5cf6",e)}),M(()=>{this.renderTypeChart(this.typeCanvas(),this.typeData())})}computeBarData(t,e,a){let n=new Map,r=this.periodRange();if(e==="week"){let d=r.start;for(let s=0;s<7;s++){let l=new Date(d);l.setDate(l.getDate()+s);let p=`${z[s]} ${l.getDate()}`;n.set(p,0)}}else if(e==="month"){let d=r.start,s=r.end,l=(d.getMonth()+1).toString().padStart(2,"0"),p=new Date(d);for(;p<=s;)n.set(`${p.getDate().toString().padStart(2,"0")}/${l}`,0),p.setDate(p.getDate()+1)}else if(e==="year"){let d=r.start.getFullYear();for(let s=0;s<12;s++)n.set(U[s],0)}else{let d=new Date().getFullYear(),s=t.length>0?new Date(t[t.length-1].start_date).getFullYear():d;for(let l=s;l<=d;l++)n.set(`${l}`,0)}for(let d of t){let s=new Date(d.start_date),l;if(e==="week"){let x=s.getDay()-1;x<0&&(x=6);let S=new Date(r.start);S.setDate(S.getDate()+x),l=`${z[x]} ${S.getDate()}`}else e==="month"?l=`${s.getDate().toString().padStart(2,"0")}/${(s.getMonth()+1).toString().padStart(2,"0")}`:e==="year"?l=U[s.getMonth()]:l=`${s.getFullYear()}`;if(!n.has(l))continue;let p;a==="distance"?p=d.distance/1e3:a==="elevation"?p=d.total_elevation_gain:p=e==="week"||e==="month"?d.moving_time/60:d.moving_time/3600,n.set(l,(n.get(l)??0)+p)}return{labels:[...n.keys()],data:[...n.values()].map(d=>Math.round(d*10)/10)}}computeTypeDistribution(t){let e=new Map;for(let n of t)e.set(n.type,(e.get(n.type)??0)+1);let a=[...e.entries()].sort((n,r)=>r[1]-n[1]);return{labels:a.map(([n])=>G(n)),data:a.map(([,n])=>n),colors:a.map(([n])=>Q(n))}}renderBar(t,e,a,n,r){if(!t)return;let d=a==="bar"?this.barChart:a==="elev"?this.elevChart:this.durationChart;d&&d.destroy();let s=new F(t.nativeElement,{type:"bar",data:{labels:e.labels,datasets:[{label:r,data:e.data,backgroundColor:n+"99",hoverBackgroundColor:n,borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,plugins:{legend:{display:!1},tooltip:{backgroundColor:"#1B1F3B",titleFont:{weight:"bold"},padding:12,cornerRadius:8,callbacks:{label:l=>` ${l.parsed.y} ${r}`}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:r,color:"#94a3b8"},grid:{color:"#f1f5f9"},ticks:{color:"#94a3b8"}},x:{grid:{display:!1},ticks:{color:"#94a3b8",maxRotation:45}}}}});a==="bar"?this.barChart=s:a==="elev"?this.elevChart=s:this.durationChart=s}renderTypeChart(t,e){t&&(this.typeChart&&this.typeChart.destroy(),this.typeChart=new F(t.nativeElement,{type:"doughnut",data:{labels:e.labels,datasets:[{data:e.data,backgroundColor:e.colors,borderWidth:3,borderColor:"#ffffff",hoverBorderColor:"#ffffff",hoverOffset:8}]},options:{responsive:!0,cutout:"60%",plugins:{legend:{position:"bottom",labels:{padding:16,usePointStyle:!0,boxWidth:8,boxHeight:8,color:"#64748b",font:{size:12}}},tooltip:{backgroundColor:"#1B1F3B",titleFont:{weight:"bold"},padding:12,cornerRadius:8,callbacks:{label:a=>{let n=a.dataset.data.reduce((d,s)=>d+s,0),r=Math.round(a.parsed/n*100);return` ${a.label} : ${a.parsed} (${r}%)`}}}}}}))}static \u0275fac=function(e){return new(e||m)};static \u0275cmp=j({type:m,selectors:[["app-dashboard"]],viewQuery:function(e,a){e&1&&H(a.barCanvas,X,5)(a.typeCanvas,ee,5)(a.elevCanvas,te,5)(a.durationCanvas,ae,5),e&2&&K(4)},decls:12,vars:4,consts:[["barChart",""],["typeChart",""],["elevChart",""],["durationChart",""],[1,"max-w-7xl","mx-auto","px-6","py-8"],[1,"flex","flex-wrap","items-center","justify-between","gap-4","mb-8"],[1,"text-3xl","font-bold","text-slate-800","tracking-tight"],[1,"flex","bg-white/80","backdrop-blur-sm","rounded-xl","shadow-sm","border","border-slate-200/60","p-1","gap-1"],[3,"class"],[1,"flex","items-center","gap-3","mb-6"],[1,"text-sm","text-slate-400","mb-6","font-medium"],[1,"text-center","py-16"],[1,"bg-red-50","border","border-red-200","text-red-700","px-5","py-4","rounded-xl","mb-6","font-medium"],[3,"click"],[1,"p-2","rounded-xl","hover:bg-white","hover:shadow-sm","text-slate-400","hover:text-slate-700","transition-all","duration-200",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"text-sm","font-semibold","px-4","py-1.5","rounded-xl","transition-all","duration-200",3,"click"],[1,"p-2","rounded-xl","transition-all","duration-200",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"text-xs","font-semibold","text-strava","hover:text-strava-dark","ml-1","transition-colors"],[1,"text-xs","font-semibold","text-strava","hover:text-strava-dark","ml-1","transition-colors",3,"click"],[1,"inline-block","h-10","w-10","animate-spin","rounded-full","border-4","border-strava","border-r-transparent"],[1,"mt-3","text-slate-400","font-medium"],[1,"grid","grid-cols-2","md:grid-cols-3","lg:grid-cols-6","gap-4","mb-8"],[1,"bg-gradient-to-br","from-orange-500","to-red-500","rounded-2xl","shadow-lg","shadow-orange-500/20","p-5","text-white"],[1,"text-xs","uppercase","tracking-wider","opacity-80","font-semibold"],[1,"text-3xl","font-extrabold","mt-2"],[1,"bg-gradient-to-br","from-blue-500","to-indigo-600","rounded-2xl","shadow-lg","shadow-blue-500/20","p-5","text-white"],[1,"text-base","font-medium","opacity-80"],[1,"bg-gradient-to-br","from-emerald-500","to-teal-600","rounded-2xl","shadow-lg","shadow-emerald-500/20","p-5","text-white"],[1,"bg-gradient-to-br","from-violet-500","to-purple-600","rounded-2xl","shadow-lg","shadow-violet-500/20","p-5","text-white"],[1,"bg-gradient-to-br","from-cyan-500","to-blue-500","rounded-2xl","shadow-lg","shadow-cyan-500/20","p-5","text-white"],[1,"bg-gradient-to-br","from-rose-500","to-pink-600","rounded-2xl","shadow-lg","shadow-rose-500/20","p-5","text-white"],[1,"mb-8","-mt-4"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6","mb-6"],[1,"bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-sm","border","border-slate-200/60","p-6","lg:col-span-2","hover:shadow-md","transition-shadow","duration-300"],[1,"text-base","font-semibold","text-slate-700","mb-4"],[1,"bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-sm","border","border-slate-200/60","p-6","hover:shadow-md","transition-shadow","duration-300"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"flex","items-center","gap-2","mb-2","px-1"],[1,"text-xs","font-semibold","text-slate-400","uppercase","tracking-wider"],[1,"text-[10px]","font-medium","text-amber-600","bg-amber-50","border","border-amber-200/60","px-2","py-0.5","rounded-full"],[1,"grid","grid-cols-2","md:grid-cols-3","lg:grid-cols-5","gap-3"],[1,"bg-white/60","backdrop-blur-sm","rounded-xl","border","border-slate-200/40","px-4","py-3","flex","items-center","justify-between"],[1,"text-xs","font-medium","text-slate-500"],[1,"text-sm","font-bold","px-2","py-0.5","rounded-lg"]],template:function(e,a){e&1&&(o(0,"div",4)(1,"div",5)(2,"h1",6),c(3,"Tableau de bord"),i(),o(4,"div",7),N(5,ie,2,3,"button",8,ne),i()(),E(7,de,10,7,"div",9)(8,le,2,1,"p",10),E(9,se,4,0,"div",11),E(10,me,2,1,"div",12),E(11,he,60,10),i()),e&2&&(u(5),A(a.periods),u(2),D(a.selectedPeriod()!=="all"?7:8),u(2),D(a.strava.loading()?9:-1),u(),D(a.strava.error()?10:-1),u(),D(a.strava.loading()?-1:11))},encapsulation:2})};export{Z as Dashboard};
