import{a as I,b as B}from"./chunk-PLB6XAD3.js";import{g as J}from"./chunk-YG4VNUMJ.js";import{Bb as w,Eb as q,Ga as $,Jb as Q,P,Qa as k,Ra as S,Ta as A,Ua as F,Va as N,Wa as m,Xa as c,Ya as D,ga as R,gb as M,kb as T,lb as L,pb as v,qb as C,rb as H,va as g,vb as Y,wb as O,za as E}from"./chunk-ITJSZUQR.js";var W=["progressionChart"],Z=o=>["/activities",o],j=()=>({from:"progression"}),z=(o,i)=>i.label;function G(o,i){o&1&&(m(0,"div",3),D(1,"div",4),m(2,"p",5),v(3,"Chargement des donn\xE9es..."),c()())}function K(o,i){if(o&1&&(m(0,"a",11)(1,"div",12)(2,"span",13),v(3),c(),m(4,"div",14)(5,"p",15),v(6),c(),m(7,"p",16),v(8),c(),m(9,"p",17),v(10),c(),m(11,"p",18),v(12),c()()()()),o&2){let e=i.$implicit;N("routerLink",O(7,Z,e.activityId))("queryParams",Y(9,j)),g(3),C(e.icon),g(3),C(e.label),g(2),C(e.value),g(2),H(" ",e.activityName," "),g(2),C(e.date)}}function U(o,i){if(o&1&&(m(0,"div",8)(1,"h2",9),v(2,"Records personnels"),c(),m(3,"div",10),A(4,K,13,10,"a",11,z),c()()),o&2){let e=M(2);g(4),F(e.records())}}function X(o,i){if(o&1&&(m(0,"div",6)(1,"h2",7),v(2,"Progression depuis mes d\xE9buts"),c(),D(3,"canvas",null,0),c(),k(5,U,6,0,"div",8)),o&2){let e=M();g(5),S(e.records().length>0?5:-1)}}I.register(...B);var ee=["Jan","F\xE9v","Mar","Avr","Mai","Juin","Juil","Ao\xFBt","Sep","Oct","Nov","D\xE9c"],V=class o{strava=P(Q);progressionCanvas=q("progressionChart");progressionChartInstance=null;constructor(){E(()=>{this.strava.activities().length===0&&this.strava.loadAllActivities()}),R(()=>{this.renderProgressionChart(this.progressionCanvas(),this.progressionData())})}progressionData=w(()=>{let i=this.strava.activities();if(i.length===0)return[];let e=new Date,s=new Date(i[i.length-1].start_date),u=[],h=(e.getFullYear()-s.getFullYear())*12+(e.getMonth()-s.getMonth());for(let n=h;n>=0;n--){let a=new Date(e.getFullYear(),e.getMonth()-n,1),f=new Date(a.getFullYear(),a.getMonth()+1,0,23,59,59,999),_=`${ee[a.getMonth()]} ${a.getFullYear().toString().slice(2)}`,t=i.filter(l=>{let b=new Date(l.start_date);return b>=a&&b<=f}),d=t.reduce((l,b)=>l+b.distance,0)/1e3,x=t.length,r=t.filter(l=>l.type==="Run"||l.type==="TrailRun"),p=r.reduce((l,b)=>l+b.moving_time,0),y=r.reduce((l,b)=>l+b.distance,0);u.push({label:_,distance:Math.round(d),count:x,runTime:p,runDist:y})}return u});records=w(()=>{let i=this.strava.activities();if(i.length===0)return[];let e=[],s=t=>new Date(t).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),u=i.filter(t=>t.type==="Run"||t.type==="TrailRun");if(u.length>0){let t=u.reduce((r,p)=>p.distance>r.distance?p:r);e.push({label:"Plus longue course",value:`${(t.distance/1e3).toFixed(1)} km`,activityName:t.name,activityId:t.id,date:s(t.start_date),icon:"\u{1F3C3}"});let d=u.filter(r=>r.distance>=5e3);if(d.length>0){let r=d.reduce((y,l)=>l.average_speed>y.average_speed?l:y),p=Math.round(1e3/r.average_speed);e.push({label:"Meilleur 5 km (estim\xE9)",value:`${Math.floor(p/60)}:${(p%60).toString().padStart(2,"0")} /km`,activityName:r.name,activityId:r.id,date:s(r.start_date),icon:"\u26A1"})}let x=u.filter(r=>r.distance>=1e4);if(x.length>0){let r=x.reduce((y,l)=>l.average_speed>y.average_speed?l:y),p=Math.round(1e3/r.average_speed);e.push({label:"Meilleur 10 km (estim\xE9)",value:`${Math.floor(p/60)}:${(p%60).toString().padStart(2,"0")} /km`,activityName:r.name,activityId:r.id,date:s(r.start_date),icon:"\u{1F525}"})}}let h=i.filter(t=>t.type==="Ride"||t.type==="VirtualRide");if(h.length>0){let t=h.reduce((d,x)=>x.distance>d.distance?x:d);e.push({label:"Plus longue sortie v\xE9lo",value:`${(t.distance/1e3).toFixed(1)} km`,activityName:t.name,activityId:t.id,date:s(t.start_date),icon:"\u{1F6B4}"})}let n=i.reduce((t,d)=>d.total_elevation_gain>t.total_elevation_gain?d:t);n.total_elevation_gain>0&&e.push({label:"Plus gros d\xE9nivel\xE9",value:`${Math.round(n.total_elevation_gain)} m`,activityName:n.name,activityId:n.id,date:s(n.start_date),icon:"\u26F0\uFE0F"});let a=i.reduce((t,d)=>d.moving_time>t.moving_time?d:t),f=Math.floor(a.moving_time/3600),_=Math.floor(a.moving_time%3600/60);return e.push({label:"Plus longue activit\xE9",value:`${f}h${_.toString().padStart(2,"0")}`,activityName:a.name,activityId:a.id,date:s(a.start_date),icon:"\u23F1\uFE0F"}),e});renderProgressionChart(i,e){if(!i)return;this.progressionChartInstance&&this.progressionChartInstance.destroy();let s=e.map(n=>n.runDist===0?null:Math.round(n.runTime/(n.runDist/1e3)*10)/10/60),u=e.length>24?2:4,h=e.length>24?4:6;this.progressionChartInstance=new I(i.nativeElement,{type:"line",data:{labels:e.map(n=>n.label),datasets:[{label:"Distance (km)",data:e.map(n=>n.distance),borderColor:"#3b82f6",backgroundColor:"#3b82f640",fill:!0,tension:.3,yAxisID:"y",pointRadius:u,pointHoverRadius:h,pointStyle:"line"},{label:"Nb activit\xE9s",data:e.map(n=>n.count),borderColor:"#f97316",backgroundColor:"#f9731600",tension:.3,yAxisID:"y1",pointRadius:u,pointHoverRadius:h,pointStyle:"line"},{label:"Allure moyenne",data:s,borderColor:"#ef4444",backgroundColor:"#ef444400",borderDash:[5,5],tension:.3,yAxisID:"y2",pointRadius:u>2?u-1:1,pointHoverRadius:h-1,spanGaps:!0,pointStyle:"line"}]},options:{responsive:!0,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"bottom",labels:{padding:16,usePointStyle:!0,pointStyleWidth:30,color:"#64748b",font:{size:12},generateLabels:n=>n.data.datasets.map((a,f)=>({text:a.label??"",strokeStyle:a.borderColor,fillStyle:"transparent",lineDash:a.borderDash??[],lineWidth:2,pointStyle:"line",hidden:!n.isDatasetVisible(f),datasetIndex:f}))}},tooltip:{backgroundColor:"#1B1F3B",titleFont:{weight:"bold"},padding:12,cornerRadius:8,callbacks:{label:n=>{let a=n.parsed.y??0;if(n.datasetIndex===2){let f=Math.floor(a),_=Math.round((a-f)*60);return` Allure : ${f}:${_.toString().padStart(2,"0")} /km`}return n.datasetIndex===1?` ${a} activit\xE9s`:` ${a} km`}}}},scales:{y:{type:"linear",position:"left",beginAtZero:!0,title:{display:!0,text:"km",color:"#3b82f6"},grid:{color:"#f1f5f9"},ticks:{color:"#3b82f6"}},y1:{type:"linear",position:"right",beginAtZero:!0,title:{display:!0,text:"Activit\xE9s",color:"#f97316"},grid:{drawOnChartArea:!1},ticks:{color:"#f97316"}},y2:{type:"linear",position:"right",reverse:!0,title:{display:!1},grid:{drawOnChartArea:!1},ticks:{display:!1}},x:{grid:{display:!1},ticks:{color:"#94a3b8"}}}}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=$({type:o,selectors:[["app-progression"]],viewQuery:function(e,s){e&1&&T(s.progressionCanvas,W,5),e&2&&L()},decls:5,vars:2,consts:[["progressionChart",""],[1,"max-w-7xl","mx-auto","px-6","py-8"],[1,"text-3xl","font-bold","text-slate-800","tracking-tight","mb-8"],[1,"text-center","py-16"],[1,"inline-block","h-10","w-10","animate-spin","rounded-full","border-4","border-strava","border-r-transparent"],[1,"mt-3","text-slate-400","font-medium"],[1,"bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-sm","border","border-slate-200/60","p-6","hover:shadow-md","transition-shadow","duration-300"],[1,"text-base","font-semibold","text-slate-700","mb-4"],[1,"mt-8"],[1,"text-xl","font-bold","text-slate-800","tracking-tight","mb-4"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"group","bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-sm","border","border-slate-200/60","p-5","hover:shadow-md","hover:border-strava/30","transition-all","duration-300",3,"routerLink","queryParams"],[1,"flex","items-start","gap-4"],[1,"text-2xl"],[1,"min-w-0","flex-1"],[1,"text-xs","font-semibold","text-slate-400","uppercase","tracking-wider"],[1,"text-2xl","font-extrabold","text-slate-800","mt-1"],[1,"text-sm","text-slate-500","mt-1","truncate","group-hover:text-strava","transition-colors"],[1,"text-xs","text-slate-400","mt-0.5"]],template:function(e,s){e&1&&(m(0,"div",1)(1,"h1",2),v(2,"Progression"),c(),k(3,G,4,0,"div",3),k(4,X,6,1),c()),e&2&&(g(3),S(s.strava.loading()?3:-1),g(),S(s.strava.loading()?-1:4))},dependencies:[J],encapsulation:2})};export{V as Progression};
