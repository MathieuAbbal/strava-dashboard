import{a as H,b as tt}from"./chunk-KISZEE3Z.js";import{g as G}from"./chunk-27D2G7FL.js";import{b as X}from"./chunk-KSVBKDBG.js";import{$a as N,Aa as j,Eb as T,Ha as O,Hb as z,Nb as U,Q as Y,Sa as I,Ta as R,Wa as V,Xa as W,Ya as J,Za as s,_a as d,ha as q,jb as L,nb as K,ob as Q,sb as u,tb as k,ub as F,wa as f,yb as B,zb as Z}from"./chunk-XYDX6LLM.js";var at=["progressionChart"],it=p=>["/activities",p],nt=()=>({from:"progression"}),ot=(p,a)=>a.label;function rt(p,a){p&1&&(s(0,"div",3),N(1,"div",4),s(2,"p",5),u(3,"Chargement des donn\xE9es..."),d()())}function st(p,a){if(p&1&&(s(0,"div",10)(1,"h2",11),u(2,"Totaux carri\xE8re"),d(),s(3,"div",12)(4,"div",13)(5,"p",14),u(6,"Distance totale"),d(),s(7,"p",15),u(8),s(9,"span",16),u(10,"km"),d()()(),s(11,"div",17)(12,"p",14),u(13,"D\xE9nivel\xE9 total"),d(),s(14,"p",15),u(15),s(16,"span",16),u(17,"m"),d()()(),s(18,"div",18)(19,"p",14),u(20,"Temps total"),d(),s(21,"p",15),u(22),d()(),s(23,"div",19)(24,"p",14),u(25,"Activit\xE9s"),d(),s(26,"p",15),u(27),d(),s(28,"p",20),u(29),d()()()()),p&2){let t=a;f(8),F("",t.distanceKm," "),f(7),F("",t.elevation," "),f(7),k(t.duration),f(5),k(t.count),f(2),F("depuis ",t.since)}}function lt(p,a){if(p&1&&(s(0,"a",22)(1,"div",23)(2,"span",24),u(3),d(),s(4,"div",25)(5,"p",26),u(6),d(),s(7,"p",27),u(8),d(),s(9,"p",28),u(10),d(),s(11,"p",29),u(12),d()()()()),p&2){let t=a.$implicit;J("routerLink",Z(8,it,t.activityId))("queryParams",B(10,nt))("title",t.tooltip??""),f(3),k(t.icon),f(3),k(t.label),f(2),k(t.value),f(2),F(" ",t.activityName," "),f(2),k(t.date)}}function dt(p,a){if(p&1&&(s(0,"div",10)(1,"h2",11),u(2,"Records personnels"),d(),s(3,"div",21),V(4,lt,13,11,"a",22,ot),d()()),p&2){let t=L(2);f(4),W(t.records())}}function ct(p,a){if(p&1&&(s(0,"div",6)(1,"h2",7),u(2,"Progression depuis mes d\xE9buts"),d(),s(3,"div",8)(4,"div",9),N(5,"canvas",null,0),d()()(),I(7,st,30,5,"div",10),I(8,dt,6,0,"div",10)),p&2){let t,l=L();f(7),R((t=l.careerTotals())?7:-1,t),f(),R(l.records().length>0?8:-1)}}H.register(...tt);var ut=["Jan","F\xE9v","Mar","Avr","Mai","Juin","Juil","Ao\xFBt","Sep","Oct","Nov","D\xE9c"],et=class p{strava=Y(U);progressionCanvas=z("progressionChart");progressionChartInstance=null;constructor(){j(()=>{this.strava.activities().length===0&&this.strava.loadAllActivities()}),q(()=>{this.renderProgressionChart(this.progressionCanvas(),this.progressionData())})}progressionData=T(()=>{let a=this.strava.activities();if(a.length===0)return[];let t=new Date,l=new Date(a[a.length-1].start_date),h=[],y=(t.getFullYear()-l.getFullYear())*12+(t.getMonth()-l.getMonth());for(let o=y;o>=0;o--){let r=new Date(t.getFullYear(),t.getMonth()-o,1),x=new Date(r.getFullYear(),r.getMonth()+1,0,23,59,59,999),E=`${ut[r.getMonth()]} ${r.getFullYear().toString().slice(2)}`,C=a.filter(g=>{let b=new Date(g.start_date);return b>=r&&b<=x}),M=C.reduce((g,b)=>g+b.distance,0)/1e3,$=C.length,D=C.filter(g=>g.type==="Run"||g.type==="TrailRun"),P=D.reduce((g,b)=>g+b.moving_time,0),w=D.reduce((g,b)=>g+b.distance,0);h.push({label:E,distance:Math.round(M),count:$,runTime:P,runDist:w})}return h});careerTotals=T(()=>{let a=this.strava.activities();if(a.length===0)return null;let t=a.reduce((r,x)=>r+x.distance,0),l=a.reduce((r,x)=>r+x.total_elevation_gain,0),h=a.reduce((r,x)=>r+x.moving_time,0),y=a[a.length-1],o=new Date(y.start_date).toLocaleDateString("fr-FR",{month:"long",year:"numeric"});return{distanceKm:Math.round(t/1e3).toLocaleString("fr-FR"),elevation:Math.round(l).toLocaleString("fr-FR"),duration:X(h),count:a.length,since:o}});records=T(()=>{let a=this.strava.activities();if(a.length===0)return[];let t=[],l=e=>new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),h=a.filter(e=>e.type==="Run"||e.type==="TrailRun");if(h.length>0){let e=h.reduce((n,v)=>v.distance>n.distance?v:n);t.push({label:"Plus longue course",value:`${(e.distance/1e3).toFixed(1)} km`,activityName:e.name,activityId:e.id,date:l(e.start_date),icon:"\u{1F3C3}",tooltip:"Course ou trail avec la plus grande distance parcourue"});let i=h.filter(n=>n.distance>=5e3);if(i.length>0){let n=i.reduce((_,S)=>S.average_speed>_.average_speed?S:_),v=Math.round(1e3/n.average_speed);t.push({label:"Meilleur 5 km (estim\xE9)",value:`${Math.floor(v/60)}:${(v%60).toString().padStart(2,"0")} /km`,activityName:n.name,activityId:n.id,date:l(n.start_date),icon:"\u26A1",tooltip:"Meilleure allure moyenne sur une course de 5 km ou plus (estimation bas\xE9e sur la vitesse moyenne)"})}let c=h.filter(n=>n.distance>=1e4);if(c.length>0){let n=c.reduce((_,S)=>S.average_speed>_.average_speed?S:_),v=Math.round(1e3/n.average_speed);t.push({label:"Meilleur 10 km (estim\xE9)",value:`${Math.floor(v/60)}:${(v%60).toString().padStart(2,"0")} /km`,activityName:n.name,activityId:n.id,date:l(n.start_date),icon:"\u{1F525}",tooltip:"Meilleure allure moyenne sur une course de 10 km ou plus (estimation bas\xE9e sur la vitesse moyenne)"})}let m=h.filter(n=>n.distance>=21097);if(m.length>0){let n=m.reduce((_,S)=>S.average_speed>_.average_speed?S:_),v=Math.round(1e3/n.average_speed);t.push({label:"Meilleur semi (estim\xE9)",value:`${Math.floor(v/60)}:${(v%60).toString().padStart(2,"0")} /km`,activityName:n.name,activityId:n.id,date:l(n.start_date),icon:"\u{1F3C5}",tooltip:"Meilleure allure moyenne sur une course de 21.1 km ou plus (estimation bas\xE9e sur la vitesse moyenne)"})}}let y=a.filter(e=>e.type==="Ride"||e.type==="VirtualRide");if(y.length>0){let e=y.reduce((c,m)=>m.distance>c.distance?m:c);t.push({label:"Plus longue sortie v\xE9lo",value:`${(e.distance/1e3).toFixed(1)} km`,activityName:e.name,activityId:e.id,date:l(e.start_date),icon:"\u{1F6B4}",tooltip:"Sortie v\xE9lo (route ou virtuel) avec la plus grande distance"});let i=y.reduce((c,m)=>m.max_speed>c.max_speed?m:c);i.max_speed>0&&t.push({label:"Vitesse max v\xE9lo",value:`${(i.max_speed*3.6).toFixed(1)} km/h`,activityName:i.name,activityId:i.id,date:l(i.start_date),icon:"\u{1F4A8}",tooltip:"Vitesse maximale instantan\xE9e atteinte lors d'une sortie v\xE9lo"})}let o=a.reduce((e,i)=>i.total_elevation_gain>e.total_elevation_gain?i:e);o.total_elevation_gain>0&&t.push({label:"Plus gros d\xE9nivel\xE9",value:`${Math.round(o.total_elevation_gain)} m`,activityName:o.name,activityId:o.id,date:l(o.start_date),icon:"\u26F0\uFE0F",tooltip:"Activit\xE9 avec le plus grand d\xE9nivel\xE9 positif cumul\xE9 (tous types confondus)"});let r=a.reduce((e,i)=>i.moving_time>e.moving_time?i:e),x=Math.floor(r.moving_time/3600),E=Math.floor(r.moving_time%3600/60);t.push({label:"Plus longue activit\xE9",value:`${x}h${E.toString().padStart(2,"0")}`,activityName:r.name,activityId:r.id,date:l(r.start_date),icon:"\u23F1\uFE0F",tooltip:"Activit\xE9 avec le plus long temps en mouvement (tous types confondus)"});let C=a.filter(e=>e.max_heartrate&&e.max_heartrate>0);if(C.length>0){let e=C.reduce((i,c)=>(c.max_heartrate??0)>(i.max_heartrate??0)?c:i);t.push({label:"FC max atteinte",value:`${e.max_heartrate} bpm`,activityName:e.name,activityId:e.id,date:l(e.start_date),icon:"\u2764\uFE0F",tooltip:"Fr\xE9quence cardiaque maximale enregistr\xE9e sur une activit\xE9 (n\xE9cessite un capteur cardio)"})}let M=new Map;for(let e of a){let i=new Date(e.start_date),c=i.getDay(),m=new Date(i);m.setDate(m.getDate()-(c===0?6:c-1));let n=`${m.getFullYear()}-${(m.getMonth()+1).toString().padStart(2,"0")}-${m.getDate().toString().padStart(2,"0")}`,v=M.get(n),_=(v?.dist??0)+e.distance;M.set(n,{dist:_,act:v&&v.dist>=_?v.act:e})}let $="",D=0;for(let[e,i]of M)i.dist>D&&(D=i.dist,$=e);if(D>0){let e=M.get($),i=new Date($),c=new Date(i);c.setDate(c.getDate()+6);let m=n=>n.toLocaleDateString("fr-FR",{day:"numeric",month:"short"});t.push({label:"Meilleur volume hebdo",value:`${(D/1e3).toFixed(1)} km`,activityName:`Semaine du ${m(i)}`,activityId:e.act.id,date:`${m(i)} - ${m(c)}`,icon:"\u{1F4CA}",tooltip:"Semaine (lundi-dimanche) avec le plus de kilom\xE8tres cumul\xE9s toutes activit\xE9s confondues"})}let P=new Set;for(let e of a){let i=new Date(e.start_date);P.add(`${i.getFullYear()}-${(i.getMonth()+1).toString().padStart(2,"0")}-${i.getDate().toString().padStart(2,"0")}`)}let w=[...P].sort(),g=1,b=1,A=0;for(let e=1;e<w.length;e++){let i=new Date(w[e-1]),c=new Date(w[e]);Math.round((c.getTime()-i.getTime())/864e5)===1?(b++,b>g&&(g=b,A=e)):b=1}if(g>=2){let e=w[A],i=w[A-g+1],c=a.find(m=>{let n=new Date(m.start_date);return`${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,"0")}-${n.getDate().toString().padStart(2,"0")}`===i});t.push({label:"Plus long streak",value:`${g} jours`,activityName:`${new Date(i).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})} - ${new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})}`,activityId:c?.id??a[0].id,date:`${g} jours cons\xE9cutifs`,icon:"\u{1F525}",tooltip:"Plus grand nombre de jours cons\xE9cutifs avec au moins une activit\xE9 enregistr\xE9e"})}return t});renderProgressionChart(a,t){if(!a)return;this.progressionChartInstance&&this.progressionChartInstance.destroy();let l=t.map(o=>o.runDist===0?null:Math.round(o.runTime/(o.runDist/1e3)*10)/10/60),h=t.length>24?2:4,y=t.length>24?4:6;this.progressionChartInstance=new H(a.nativeElement,{type:"line",data:{labels:t.map(o=>o.label),datasets:[{label:"Distance (km)",data:t.map(o=>o.distance),borderColor:"#3b82f6",backgroundColor:"#3b82f640",fill:!0,tension:.3,yAxisID:"y",pointRadius:h,pointHoverRadius:y,pointStyle:"line"},{label:"Nb activit\xE9s",data:t.map(o=>o.count),borderColor:"#f97316",backgroundColor:"#f9731600",tension:.3,yAxisID:"y1",pointRadius:h,pointHoverRadius:y,pointStyle:"line"},{label:"Allure moyenne",data:l,borderColor:"#ef4444",backgroundColor:"#ef444400",borderDash:[5,5],tension:.3,yAxisID:"y2",pointRadius:h>2?h-1:1,pointHoverRadius:y-1,spanGaps:!0,pointStyle:"line"}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"bottom",labels:{padding:16,usePointStyle:!0,pointStyleWidth:30,color:"#64748b",font:{size:12},generateLabels:o=>o.data.datasets.map((r,x)=>({text:r.label??"",strokeStyle:r.borderColor,fillStyle:"transparent",lineDash:r.borderDash??[],lineWidth:2,pointStyle:"line",hidden:!o.isDatasetVisible(x),datasetIndex:x}))}},tooltip:{backgroundColor:"#1B1F3B",titleFont:{weight:"bold"},padding:12,cornerRadius:8,callbacks:{label:o=>{let r=o.parsed.y??0;if(o.datasetIndex===2){let x=Math.floor(r),E=Math.round((r-x)*60);return` Allure : ${x}:${E.toString().padStart(2,"0")} /km`}return o.datasetIndex===1?` ${r} activit\xE9s`:` ${r} km`}}}},scales:{y:{type:"linear",position:"left",beginAtZero:!0,title:{display:!0,text:"km",color:"#3b82f6"},grid:{color:"#f1f5f9"},ticks:{color:"#3b82f6"}},y1:{type:"linear",position:"right",beginAtZero:!0,title:{display:!0,text:"Activit\xE9s",color:"#f97316"},grid:{drawOnChartArea:!1},ticks:{color:"#f97316"}},y2:{type:"linear",position:"right",reverse:!0,title:{display:!1},grid:{drawOnChartArea:!1},ticks:{display:!1}},x:{grid:{display:!1},ticks:{color:"#94a3b8",maxRotation:45,autoSkip:!0,maxTicksLimit:12}}}}})}static \u0275fac=function(t){return new(t||p)};static \u0275cmp=O({type:p,selectors:[["app-progression"]],viewQuery:function(t,l){t&1&&K(l.progressionCanvas,at,5),t&2&&Q()},decls:5,vars:2,consts:[["progressionChart",""],[1,"max-w-7xl","mx-auto","px-6","py-8"],[1,"text-3xl","font-bold","text-slate-800","tracking-tight","mb-8"],[1,"text-center","py-16"],[1,"inline-block","h-10","w-10","animate-spin","rounded-full","border-4","border-strava","border-r-transparent"],[1,"mt-3","text-slate-400","font-medium"],[1,"bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-sm","border","border-slate-200/60","p-6","hover:shadow-md","transition-shadow","duration-300"],[1,"text-base","font-semibold","text-slate-700","mb-4"],[1,"overflow-x-auto"],[1,"min-w-[600px]","h-[300px]","sm:h-[400px]"],[1,"mt-8"],[1,"text-xl","font-bold","text-slate-800","tracking-tight","mb-4"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4"],[1,"bg-gradient-to-br","from-blue-500","to-indigo-600","rounded-2xl","shadow-lg","shadow-blue-500/20","p-5","text-white"],[1,"text-xs","uppercase","tracking-wider","opacity-80","font-semibold"],[1,"text-3xl","font-extrabold","mt-2"],[1,"text-base","font-medium","opacity-80"],[1,"bg-gradient-to-br","from-emerald-500","to-teal-600","rounded-2xl","shadow-lg","shadow-emerald-500/20","p-5","text-white"],[1,"bg-gradient-to-br","from-violet-500","to-purple-600","rounded-2xl","shadow-lg","shadow-violet-500/20","p-5","text-white"],[1,"bg-gradient-to-br","from-orange-500","to-red-500","rounded-2xl","shadow-lg","shadow-orange-500/20","p-5","text-white"],[1,"text-xs","opacity-70","mt-1"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"group","bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-sm","border","border-slate-200/60","p-5","hover:shadow-md","hover:border-strava/30","transition-all","duration-300",3,"routerLink","queryParams","title"],[1,"flex","items-start","gap-4"],[1,"text-2xl"],[1,"min-w-0","flex-1"],[1,"text-xs","font-semibold","text-slate-400","uppercase","tracking-wider"],[1,"text-2xl","font-extrabold","text-slate-800","mt-1"],[1,"text-sm","text-slate-500","mt-1","truncate","group-hover:text-strava","transition-colors"],[1,"text-xs","text-slate-400","mt-0.5"]],template:function(t,l){t&1&&(s(0,"div",1)(1,"h1",2),u(2,"Progression"),d(),I(3,rt,4,0,"div",3),I(4,ct,9,2),d()),t&2&&(f(3),R(l.strava.loading()?3:-1),f(),R(l.strava.loading()?-1:4))},dependencies:[G],encapsulation:2})};export{et as Progression};
