import{a as q,b as it}from"./chunk-KISZEE3Z.js";import{g as X}from"./chunk-27D2G7FL.js";import{b as et}from"./chunk-KSVBKDBG.js";import{$a as H,Aa as V,Eb as A,Ha as W,Hb as U,Nb as tt,Q as j,Sa as R,Ta as F,Wa as J,Xa as K,Ya as Q,Za as r,_a as l,ha as O,jb as Y,nb as B,ob as Z,sb as c,tb as C,ub as P,wa as v,yb as z,zb as G}from"./chunk-XYDX6LLM.js";var at=["progressionChart"],ot=m=>["/activities",m],rt=()=>({from:"progression"}),st=(m,i)=>i.label;function lt(m,i){m&1&&(r(0,"div",3),H(1,"div",4),r(2,"p",5),c(3,"Chargement des donn\xE9es..."),l()())}function dt(m,i){if(m&1&&(r(0,"div",10)(1,"h2",11),c(2,"Totaux carri\xE8re"),l(),r(3,"div",12)(4,"div",13)(5,"p",14),c(6,"Distance totale"),l(),r(7,"p",15),c(8),r(9,"span",16),c(10,"km"),l()()(),r(11,"div",17)(12,"p",14),c(13,"D\xE9nivel\xE9 total"),l(),r(14,"p",15),c(15),r(16,"span",16),c(17,"m"),l()()(),r(18,"div",18)(19,"p",14),c(20,"Temps total"),l(),r(21,"p",15),c(22),l()(),r(23,"div",19)(24,"p",14),c(25,"Activit\xE9s"),l(),r(26,"p",15),c(27),l(),r(28,"p",20),c(29),l()()()()),m&2){let t=i;v(8),P("",t.distanceKm," "),v(7),P("",t.elevation," "),v(7),C(t.duration),v(5),C(t.count),v(2),P("depuis ",t.since)}}function ct(m,i){if(m&1&&(r(0,"a",22)(1,"div",23)(2,"span",24),c(3),l(),r(4,"div",25)(5,"p",26),c(6),l(),r(7,"p",27),c(8),l(),r(9,"p",28),c(10),l(),r(11,"p",29),c(12),l()()()()),m&2){let t=i.$implicit;Q("routerLink",G(8,ot,t.activityId))("queryParams",z(10,rt))("title",t.tooltip??""),v(3),C(t.icon),v(3),C(t.label),v(2),C(t.value),v(2),P(" ",t.activityName," "),v(2),C(t.date)}}function ut(m,i){if(m&1&&(r(0,"div",10)(1,"h2",11),c(2,"Records personnels"),l(),r(3,"div",21),J(4,ct,13,11,"a",22,st),l()()),m&2){let t=Y(2);v(4),K(t.records())}}function mt(m,i){if(m&1&&(r(0,"div",6)(1,"h2",7),c(2,"Progression depuis mes d\xE9buts"),l(),r(3,"div",8)(4,"div",9),H(5,"canvas",null,0),l()()(),R(7,dt,30,5,"div",10),R(8,ut,6,0,"div",10)),m&2){let t,s=Y();v(7),F((t=s.careerTotals())?7:-1,t),v(),F(s.records().length>0?8:-1)}}q.register(...it);var pt=["Jan","F\xE9v","Mar","Avr","Mai","Juin","Juil","Ao\xFBt","Sep","Oct","Nov","D\xE9c"],nt=class m{strava=j(tt);progressionCanvas=U("progressionChart");progressionChartInstance=null;constructor(){V(()=>{this.strava.activities().length===0&&this.strava.loadAllActivities()}),O(()=>{this.renderProgressionChart(this.progressionCanvas(),this.progressionData())})}progressionData=A(()=>{let i=this.strava.activities();if(i.length===0)return[];let t=new Date,s=new Date(i[i.length-1].start_date),f=[],S=(t.getFullYear()-s.getFullYear())*12+(t.getMonth()-s.getMonth());for(let a=S;a>=0;a--){let o=new Date(t.getFullYear(),t.getMonth()-a,1),h=new Date(o.getFullYear(),o.getMonth()+1,0,23,59,59,999),I=`${pt[o.getMonth()]} ${o.getFullYear().toString().slice(2)}`,M=i.filter(g=>{let y=new Date(g.start_date);return y>=o&&y<=h}),E=M.reduce((g,y)=>g+y.distance,0)/1e3,$=M.length,w=M.filter(g=>g.type==="Run"||g.type==="TrailRun"),T=w.reduce((g,y)=>g+y.moving_time,0),k=w.reduce((g,y)=>g+y.distance,0);f.push({label:I,distance:Math.round(E),count:$,runTime:T,runDist:k})}return f});careerTotals=A(()=>{let i=this.strava.activities();if(i.length===0)return null;let t=i.reduce((o,h)=>o+h.distance,0),s=i.reduce((o,h)=>o+h.total_elevation_gain,0),f=i.reduce((o,h)=>o+h.moving_time,0),S=i[i.length-1],a=new Date(S.start_date).toLocaleDateString("fr-FR",{month:"long",year:"numeric"});return{distanceKm:Math.round(t/1e3).toLocaleString("fr-FR"),elevation:Math.round(s).toLocaleString("fr-FR"),duration:et(f),count:i.length,since:a}});records=A(()=>{let i=this.strava.activities();if(i.length===0)return[];let t=[],s=e=>new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),f=i.filter(e=>e.type==="Run"||e.type==="TrailRun");if(f.length>0){let e=f.reduce((p,b)=>b.distance>p.distance?b:p);t.push({label:"Plus longue course",value:`${(e.distance/1e3).toFixed(1)} km`,activityName:e.name,activityId:e.id,date:s(e.start_date),icon:"\u{1F3C3}",tooltip:"Course ou trail avec la plus grande distance parcourue"});let n=f.filter(p=>p.distance>=5e3),d=f.filter(p=>p.distance>=1e4),u=f.filter(p=>p.distance>=21097),x=n.length>0?n.reduce((p,b)=>b.average_speed>p.average_speed?b:p):null,_=d.length>0?d.reduce((p,b)=>b.average_speed>p.average_speed?b:p):null,D=u.length>0?u.reduce((p,b)=>b.average_speed>p.average_speed?b:p):null,L=p=>{let b=Math.round(1e3/p);return`${Math.floor(b/60)}:${(b%60).toString().padStart(2,"0")} /km`};x&&(!_||x.id!==_.id)&&t.push({label:"Meilleur 5 km (estim\xE9)",value:L(x.average_speed),activityName:x.name,activityId:x.id,date:s(x.start_date),icon:"\u26A1",tooltip:"Meilleure allure moyenne sur une course de 5 km ou plus (estimation bas\xE9e sur la vitesse moyenne)"}),_&&(!D||_.id!==D.id)&&t.push({label:"Meilleur 10 km (estim\xE9)",value:L(_.average_speed),activityName:_.name,activityId:_.id,date:s(_.start_date),icon:"\u{1F525}",tooltip:"Meilleure allure moyenne sur une course de 10 km ou plus (estimation bas\xE9e sur la vitesse moyenne)"}),D&&t.push({label:"Meilleur semi (estim\xE9)",value:L(D.average_speed),activityName:D.name,activityId:D.id,date:s(D.start_date),icon:"\u{1F3C5}",tooltip:"Meilleure allure moyenne sur une course de 21.1 km ou plus (estimation bas\xE9e sur la vitesse moyenne)"})}let S=i.filter(e=>e.type==="Ride"||e.type==="VirtualRide");if(S.length>0){let e=S.reduce((d,u)=>u.distance>d.distance?u:d);t.push({label:"Plus longue sortie v\xE9lo",value:`${(e.distance/1e3).toFixed(1)} km`,activityName:e.name,activityId:e.id,date:s(e.start_date),icon:"\u{1F6B4}",tooltip:"Sortie v\xE9lo (route ou virtuel) avec la plus grande distance"});let n=S.reduce((d,u)=>u.max_speed>d.max_speed?u:d);n.max_speed>0&&t.push({label:"Vitesse max v\xE9lo",value:`${(n.max_speed*3.6).toFixed(1)} km/h`,activityName:n.name,activityId:n.id,date:s(n.start_date),icon:"\u{1F4A8}",tooltip:"Vitesse maximale instantan\xE9e atteinte lors d'une sortie v\xE9lo"})}let a=i.reduce((e,n)=>n.total_elevation_gain>e.total_elevation_gain?n:e);a.total_elevation_gain>0&&t.push({label:"Plus gros d\xE9nivel\xE9",value:`${Math.round(a.total_elevation_gain)} m`,activityName:a.name,activityId:a.id,date:s(a.start_date),icon:"\u26F0\uFE0F",tooltip:"Activit\xE9 avec le plus grand d\xE9nivel\xE9 positif cumul\xE9 (tous types confondus)"});let o=i.reduce((e,n)=>n.moving_time>e.moving_time?n:e),h=Math.floor(o.moving_time/3600),I=Math.floor(o.moving_time%3600/60);t.push({label:"Plus longue activit\xE9",value:`${h}h${I.toString().padStart(2,"0")}`,activityName:o.name,activityId:o.id,date:s(o.start_date),icon:"\u23F1\uFE0F",tooltip:"Activit\xE9 avec le plus long temps en mouvement (tous types confondus)"});let M=i.filter(e=>e.max_heartrate&&e.max_heartrate>0);if(M.length>0){let e=M.reduce((n,d)=>(d.max_heartrate??0)>(n.max_heartrate??0)?d:n);t.push({label:"FC max atteinte",value:`${e.max_heartrate} bpm`,activityName:e.name,activityId:e.id,date:s(e.start_date),icon:"\u2764\uFE0F",tooltip:"Fr\xE9quence cardiaque maximale enregistr\xE9e sur une activit\xE9 (n\xE9cessite un capteur cardio)"})}let E=new Map;for(let e of i){let n=new Date(e.start_date),d=n.getDay(),u=new Date(n);u.setDate(u.getDate()-(d===0?6:d-1));let x=`${u.getFullYear()}-${(u.getMonth()+1).toString().padStart(2,"0")}-${u.getDate().toString().padStart(2,"0")}`,_=E.get(x),D=(_?.dist??0)+e.distance;E.set(x,{dist:D,act:_&&_.dist>=D?_.act:e})}let $="",w=0;for(let[e,n]of E)n.dist>w&&(w=n.dist,$=e);if(w>0){let e=E.get($),n=new Date($),d=new Date(n);d.setDate(d.getDate()+6);let u=x=>x.toLocaleDateString("fr-FR",{day:"numeric",month:"short"});t.push({label:"Meilleur volume hebdo",value:`${(w/1e3).toFixed(1)} km`,activityName:`Semaine du ${u(n)}`,activityId:e.act.id,date:`${u(n)} - ${u(d)}`,icon:"\u{1F4CA}",tooltip:"Semaine (lundi-dimanche) avec le plus de kilom\xE8tres cumul\xE9s toutes activit\xE9s confondues"})}let T=new Set;for(let e of i){let n=new Date(e.start_date);T.add(`${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,"0")}-${n.getDate().toString().padStart(2,"0")}`)}let k=[...T].sort(),g=1,y=1,N=0;for(let e=1;e<k.length;e++){let n=new Date(k[e-1]),d=new Date(k[e]);Math.round((d.getTime()-n.getTime())/864e5)===1?(y++,y>g&&(g=y,N=e)):y=1}if(g>=2){let e=k[N],n=k[N-g+1],d=i.find(u=>{let x=new Date(u.start_date);return`${x.getFullYear()}-${(x.getMonth()+1).toString().padStart(2,"0")}-${x.getDate().toString().padStart(2,"0")}`===n});t.push({label:"Plus long streak",value:`${g} jours`,activityName:`${new Date(n).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})} - ${new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})}`,activityId:d?.id??i[0].id,date:`${g} jours cons\xE9cutifs`,icon:"\u{1F525}",tooltip:"Plus grand nombre de jours cons\xE9cutifs avec au moins une activit\xE9 enregistr\xE9e"})}return t});renderProgressionChart(i,t){if(!i)return;this.progressionChartInstance&&this.progressionChartInstance.destroy();let s=t.map(a=>a.runDist===0?null:Math.round(a.runTime/(a.runDist/1e3)*10)/10/60),f=t.length>24?2:4,S=t.length>24?4:6;this.progressionChartInstance=new q(i.nativeElement,{type:"line",data:{labels:t.map(a=>a.label),datasets:[{label:"Distance (km)",data:t.map(a=>a.distance),borderColor:"#3b82f6",backgroundColor:"#3b82f640",fill:!0,tension:.3,yAxisID:"y",pointRadius:f,pointHoverRadius:S,pointStyle:"line"},{label:"Nb activit\xE9s",data:t.map(a=>a.count),borderColor:"#f97316",backgroundColor:"#f9731600",tension:.3,yAxisID:"y1",pointRadius:f,pointHoverRadius:S,pointStyle:"line"},{label:"Allure moyenne",data:s,borderColor:"#ef4444",backgroundColor:"#ef444400",borderDash:[5,5],tension:.3,yAxisID:"y2",pointRadius:f>2?f-1:1,pointHoverRadius:S-1,spanGaps:!0,pointStyle:"line"}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"bottom",labels:{padding:16,usePointStyle:!0,pointStyleWidth:30,color:"#64748b",font:{size:12},generateLabels:a=>a.data.datasets.map((o,h)=>({text:o.label??"",strokeStyle:o.borderColor,fillStyle:"transparent",lineDash:o.borderDash??[],lineWidth:2,pointStyle:"line",hidden:!a.isDatasetVisible(h),datasetIndex:h}))}},tooltip:{backgroundColor:"#1B1F3B",titleFont:{weight:"bold"},padding:12,cornerRadius:8,callbacks:{label:a=>{let o=a.parsed.y??0;if(a.datasetIndex===2){let h=Math.floor(o),I=Math.round((o-h)*60);return` Allure : ${h}:${I.toString().padStart(2,"0")} /km`}return a.datasetIndex===1?` ${o} activit\xE9s`:` ${o} km`}}}},scales:{y:{type:"linear",position:"left",beginAtZero:!0,title:{display:!0,text:"km",color:"#3b82f6"},grid:{color:"#f1f5f9"},ticks:{color:"#3b82f6"}},y1:{type:"linear",position:"right",beginAtZero:!0,title:{display:!0,text:"Activit\xE9s",color:"#f97316"},grid:{drawOnChartArea:!1},ticks:{color:"#f97316"}},y2:{type:"linear",position:"right",reverse:!0,title:{display:!1},grid:{drawOnChartArea:!1},ticks:{display:!1}},x:{grid:{display:!1},ticks:{color:"#94a3b8",maxRotation:45,autoSkip:!0,maxTicksLimit:12}}}}})}static \u0275fac=function(t){return new(t||m)};static \u0275cmp=W({type:m,selectors:[["app-progression"]],viewQuery:function(t,s){t&1&&B(s.progressionCanvas,at,5),t&2&&Z()},decls:5,vars:2,consts:[["progressionChart",""],[1,"max-w-7xl","mx-auto","px-6","py-8"],[1,"text-3xl","font-bold","text-slate-800","tracking-tight","mb-8"],[1,"text-center","py-16"],[1,"inline-block","h-10","w-10","animate-spin","rounded-full","border-4","border-strava","border-r-transparent"],[1,"mt-3","text-slate-400","font-medium"],[1,"bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-sm","border","border-slate-200/60","p-6","hover:shadow-md","transition-shadow","duration-300"],[1,"text-base","font-semibold","text-slate-700","mb-4"],[1,"overflow-x-auto"],[1,"min-w-[600px]","h-[300px]","sm:h-[400px]"],[1,"mt-8"],[1,"text-xl","font-bold","text-slate-800","tracking-tight","mb-4"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4"],[1,"bg-gradient-to-br","from-blue-500","to-indigo-600","rounded-2xl","shadow-lg","shadow-blue-500/20","p-5","text-white"],[1,"text-xs","uppercase","tracking-wider","opacity-80","font-semibold"],[1,"text-3xl","font-extrabold","mt-2"],[1,"text-base","font-medium","opacity-80"],[1,"bg-gradient-to-br","from-emerald-500","to-teal-600","rounded-2xl","shadow-lg","shadow-emerald-500/20","p-5","text-white"],[1,"bg-gradient-to-br","from-violet-500","to-purple-600","rounded-2xl","shadow-lg","shadow-violet-500/20","p-5","text-white"],[1,"bg-gradient-to-br","from-orange-500","to-red-500","rounded-2xl","shadow-lg","shadow-orange-500/20","p-5","text-white"],[1,"text-xs","opacity-70","mt-1"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"group","bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-sm","border","border-slate-200/60","p-5","hover:shadow-md","hover:border-strava/30","transition-all","duration-300",3,"routerLink","queryParams","title"],[1,"flex","items-start","gap-4"],[1,"text-2xl"],[1,"min-w-0","flex-1"],[1,"text-xs","font-semibold","text-slate-400","uppercase","tracking-wider"],[1,"text-2xl","font-extrabold","text-slate-800","mt-1"],[1,"text-sm","text-slate-500","mt-1","truncate","group-hover:text-strava","transition-colors"],[1,"text-xs","text-slate-400","mt-0.5"]],template:function(t,s){t&1&&(r(0,"div",1)(1,"h1",2),c(2,"Progression"),l(),R(3,lt,4,0,"div",3),R(4,mt,9,2),l()),t&2&&(v(3),F(s.strava.loading()?3:-1),v(),F(s.strava.loading()?-1:4))},dependencies:[X],encapsulation:2})};export{nt as Progression};
