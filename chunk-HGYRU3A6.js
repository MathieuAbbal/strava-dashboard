import{a as H,b as tt}from"./chunk-ZGOEU3JO.js";import{g as G}from"./chunk-7CCD7PYX.js";import{b as X}from"./chunk-KSVBKDBG.js";import{Cb as T,Fb as z,Ga as O,Kb as U,P as Y,Qa as I,Ra as R,Ua as V,Va as W,Wa as J,Xa as l,Ya as d,Za as A,ga as q,hb as L,lb as K,mb as Q,qb as u,rb as k,sb as F,va as f,wb as B,xb as Z,za as j}from"./chunk-BNKUSFLV.js";var at=["progressionChart"],nt=p=>["/activities",p],it=()=>({from:"progression"}),ot=(p,a)=>a.label;function rt(p,a){p&1&&(l(0,"div",3),A(1,"div",4),l(2,"p",5),u(3,"Chargement des donn\xE9es..."),d()())}function st(p,a){if(p&1&&(l(0,"div",8)(1,"h2",9),u(2,"Totaux carri\xE8re"),d(),l(3,"div",10)(4,"div",11)(5,"p",12),u(6,"Distance totale"),d(),l(7,"p",13),u(8),l(9,"span",14),u(10,"km"),d()()(),l(11,"div",15)(12,"p",12),u(13,"D\xE9nivel\xE9 total"),d(),l(14,"p",13),u(15),l(16,"span",14),u(17,"m"),d()()(),l(18,"div",16)(19,"p",12),u(20,"Temps total"),d(),l(21,"p",13),u(22),d()(),l(23,"div",17)(24,"p",12),u(25,"Activit\xE9s"),d(),l(26,"p",13),u(27),d(),l(28,"p",18),u(29),d()()()()),p&2){let t=a;f(8),F("",t.distanceKm," "),f(7),F("",t.elevation," "),f(7),k(t.duration),f(5),k(t.count),f(2),F("depuis ",t.since)}}function lt(p,a){if(p&1&&(l(0,"a",20)(1,"div",21)(2,"span",22),u(3),d(),l(4,"div",23)(5,"p",24),u(6),d(),l(7,"p",25),u(8),d(),l(9,"p",26),u(10),d(),l(11,"p",27),u(12),d()()()()),p&2){let t=a.$implicit;J("routerLink",Z(8,nt,t.activityId))("queryParams",B(10,it))("title",t.tooltip??""),f(3),k(t.icon),f(3),k(t.label),f(2),k(t.value),f(2),F(" ",t.activityName," "),f(2),k(t.date)}}function dt(p,a){if(p&1&&(l(0,"div",8)(1,"h2",9),u(2,"Records personnels"),d(),l(3,"div",19),V(4,lt,13,11,"a",20,ot),d()()),p&2){let t=L(2);f(4),W(t.records())}}function ct(p,a){if(p&1&&(l(0,"div",6)(1,"h2",7),u(2,"Progression depuis mes d\xE9buts"),d(),A(3,"canvas",null,0),d(),I(5,st,30,5,"div",8),I(6,dt,6,0,"div",8)),p&2){let t,s=L();f(5),R((t=s.careerTotals())?5:-1,t),f(),R(s.records().length>0?6:-1)}}H.register(...tt);var ut=["Jan","F\xE9v","Mar","Avr","Mai","Juin","Juil","Ao\xFBt","Sep","Oct","Nov","D\xE9c"],et=class p{strava=Y(U);progressionCanvas=z("progressionChart");progressionChartInstance=null;constructor(){j(()=>{this.strava.activities().length===0&&this.strava.loadAllActivities()}),q(()=>{this.renderProgressionChart(this.progressionCanvas(),this.progressionData())})}progressionData=T(()=>{let a=this.strava.activities();if(a.length===0)return[];let t=new Date,s=new Date(a[a.length-1].start_date),h=[],y=(t.getFullYear()-s.getFullYear())*12+(t.getMonth()-s.getMonth());for(let o=y;o>=0;o--){let r=new Date(t.getFullYear(),t.getMonth()-o,1),x=new Date(r.getFullYear(),r.getMonth()+1,0,23,59,59,999),E=`${ut[r.getMonth()]} ${r.getFullYear().toString().slice(2)}`,C=a.filter(g=>{let b=new Date(g.start_date);return b>=r&&b<=x}),M=C.reduce((g,b)=>g+b.distance,0)/1e3,$=C.length,D=C.filter(g=>g.type==="Run"||g.type==="TrailRun"),P=D.reduce((g,b)=>g+b.moving_time,0),w=D.reduce((g,b)=>g+b.distance,0);h.push({label:E,distance:Math.round(M),count:$,runTime:P,runDist:w})}return h});careerTotals=T(()=>{let a=this.strava.activities();if(a.length===0)return null;let t=a.reduce((r,x)=>r+x.distance,0),s=a.reduce((r,x)=>r+x.total_elevation_gain,0),h=a.reduce((r,x)=>r+x.moving_time,0),y=a[a.length-1],o=new Date(y.start_date).toLocaleDateString("fr-FR",{month:"long",year:"numeric"});return{distanceKm:Math.round(t/1e3).toLocaleString("fr-FR"),elevation:Math.round(s).toLocaleString("fr-FR"),duration:X(h),count:a.length,since:o}});records=T(()=>{let a=this.strava.activities();if(a.length===0)return[];let t=[],s=e=>new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),h=a.filter(e=>e.type==="Run"||e.type==="TrailRun");if(h.length>0){let e=h.reduce((i,v)=>v.distance>i.distance?v:i);t.push({label:"Plus longue course",value:`${(e.distance/1e3).toFixed(1)} km`,activityName:e.name,activityId:e.id,date:s(e.start_date),icon:"\u{1F3C3}",tooltip:"Course ou trail avec la plus grande distance parcourue"});let n=h.filter(i=>i.distance>=5e3);if(n.length>0){let i=n.reduce((_,S)=>S.average_speed>_.average_speed?S:_),v=Math.round(1e3/i.average_speed);t.push({label:"Meilleur 5 km (estim\xE9)",value:`${Math.floor(v/60)}:${(v%60).toString().padStart(2,"0")} /km`,activityName:i.name,activityId:i.id,date:s(i.start_date),icon:"\u26A1",tooltip:"Meilleure allure moyenne sur une course de 5 km ou plus (estimation bas\xE9e sur la vitesse moyenne)"})}let c=h.filter(i=>i.distance>=1e4);if(c.length>0){let i=c.reduce((_,S)=>S.average_speed>_.average_speed?S:_),v=Math.round(1e3/i.average_speed);t.push({label:"Meilleur 10 km (estim\xE9)",value:`${Math.floor(v/60)}:${(v%60).toString().padStart(2,"0")} /km`,activityName:i.name,activityId:i.id,date:s(i.start_date),icon:"\u{1F525}",tooltip:"Meilleure allure moyenne sur une course de 10 km ou plus (estimation bas\xE9e sur la vitesse moyenne)"})}let m=h.filter(i=>i.distance>=21097);if(m.length>0){let i=m.reduce((_,S)=>S.average_speed>_.average_speed?S:_),v=Math.round(1e3/i.average_speed);t.push({label:"Meilleur semi (estim\xE9)",value:`${Math.floor(v/60)}:${(v%60).toString().padStart(2,"0")} /km`,activityName:i.name,activityId:i.id,date:s(i.start_date),icon:"\u{1F3C5}",tooltip:"Meilleure allure moyenne sur une course de 21.1 km ou plus (estimation bas\xE9e sur la vitesse moyenne)"})}}let y=a.filter(e=>e.type==="Ride"||e.type==="VirtualRide");if(y.length>0){let e=y.reduce((c,m)=>m.distance>c.distance?m:c);t.push({label:"Plus longue sortie v\xE9lo",value:`${(e.distance/1e3).toFixed(1)} km`,activityName:e.name,activityId:e.id,date:s(e.start_date),icon:"\u{1F6B4}",tooltip:"Sortie v\xE9lo (route ou virtuel) avec la plus grande distance"});let n=y.reduce((c,m)=>m.max_speed>c.max_speed?m:c);n.max_speed>0&&t.push({label:"Vitesse max v\xE9lo",value:`${(n.max_speed*3.6).toFixed(1)} km/h`,activityName:n.name,activityId:n.id,date:s(n.start_date),icon:"\u{1F4A8}",tooltip:"Vitesse maximale instantan\xE9e atteinte lors d'une sortie v\xE9lo"})}let o=a.reduce((e,n)=>n.total_elevation_gain>e.total_elevation_gain?n:e);o.total_elevation_gain>0&&t.push({label:"Plus gros d\xE9nivel\xE9",value:`${Math.round(o.total_elevation_gain)} m`,activityName:o.name,activityId:o.id,date:s(o.start_date),icon:"\u26F0\uFE0F",tooltip:"Activit\xE9 avec le plus grand d\xE9nivel\xE9 positif cumul\xE9 (tous types confondus)"});let r=a.reduce((e,n)=>n.moving_time>e.moving_time?n:e),x=Math.floor(r.moving_time/3600),E=Math.floor(r.moving_time%3600/60);t.push({label:"Plus longue activit\xE9",value:`${x}h${E.toString().padStart(2,"0")}`,activityName:r.name,activityId:r.id,date:s(r.start_date),icon:"\u23F1\uFE0F",tooltip:"Activit\xE9 avec le plus long temps en mouvement (tous types confondus)"});let C=a.filter(e=>e.max_heartrate&&e.max_heartrate>0);if(C.length>0){let e=C.reduce((n,c)=>(c.max_heartrate??0)>(n.max_heartrate??0)?c:n);t.push({label:"FC max atteinte",value:`${e.max_heartrate} bpm`,activityName:e.name,activityId:e.id,date:s(e.start_date),icon:"\u2764\uFE0F",tooltip:"Fr\xE9quence cardiaque maximale enregistr\xE9e sur une activit\xE9 (n\xE9cessite un capteur cardio)"})}let M=new Map;for(let e of a){let n=new Date(e.start_date),c=n.getDay(),m=new Date(n);m.setDate(m.getDate()-(c===0?6:c-1));let i=`${m.getFullYear()}-${(m.getMonth()+1).toString().padStart(2,"0")}-${m.getDate().toString().padStart(2,"0")}`,v=M.get(i),_=(v?.dist??0)+e.distance;M.set(i,{dist:_,act:v&&v.dist>=_?v.act:e})}let $="",D=0;for(let[e,n]of M)n.dist>D&&(D=n.dist,$=e);if(D>0){let e=M.get($),n=new Date($),c=new Date(n);c.setDate(c.getDate()+6);let m=i=>i.toLocaleDateString("fr-FR",{day:"numeric",month:"short"});t.push({label:"Meilleur volume hebdo",value:`${(D/1e3).toFixed(1)} km`,activityName:`Semaine du ${m(n)}`,activityId:e.act.id,date:`${m(n)} - ${m(c)}`,icon:"\u{1F4CA}",tooltip:"Semaine (lundi-dimanche) avec le plus de kilom\xE8tres cumul\xE9s toutes activit\xE9s confondues"})}let P=new Set;for(let e of a){let n=new Date(e.start_date);P.add(`${n.getFullYear()}-${(n.getMonth()+1).toString().padStart(2,"0")}-${n.getDate().toString().padStart(2,"0")}`)}let w=[...P].sort(),g=1,b=1,N=0;for(let e=1;e<w.length;e++){let n=new Date(w[e-1]),c=new Date(w[e]);Math.round((c.getTime()-n.getTime())/864e5)===1?(b++,b>g&&(g=b,N=e)):b=1}if(g>=2){let e=w[N],n=w[N-g+1],c=a.find(m=>{let i=new Date(m.start_date);return`${i.getFullYear()}-${(i.getMonth()+1).toString().padStart(2,"0")}-${i.getDate().toString().padStart(2,"0")}`===n});t.push({label:"Plus long streak",value:`${g} jours`,activityName:`${new Date(n).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})} - ${new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})}`,activityId:c?.id??a[0].id,date:`${g} jours cons\xE9cutifs`,icon:"\u{1F525}",tooltip:"Plus grand nombre de jours cons\xE9cutifs avec au moins une activit\xE9 enregistr\xE9e"})}return t});renderProgressionChart(a,t){if(!a)return;this.progressionChartInstance&&this.progressionChartInstance.destroy();let s=t.map(o=>o.runDist===0?null:Math.round(o.runTime/(o.runDist/1e3)*10)/10/60),h=t.length>24?2:4,y=t.length>24?4:6;this.progressionChartInstance=new H(a.nativeElement,{type:"line",data:{labels:t.map(o=>o.label),datasets:[{label:"Distance (km)",data:t.map(o=>o.distance),borderColor:"#3b82f6",backgroundColor:"#3b82f640",fill:!0,tension:.3,yAxisID:"y",pointRadius:h,pointHoverRadius:y,pointStyle:"line"},{label:"Nb activit\xE9s",data:t.map(o=>o.count),borderColor:"#f97316",backgroundColor:"#f9731600",tension:.3,yAxisID:"y1",pointRadius:h,pointHoverRadius:y,pointStyle:"line"},{label:"Allure moyenne",data:s,borderColor:"#ef4444",backgroundColor:"#ef444400",borderDash:[5,5],tension:.3,yAxisID:"y2",pointRadius:h>2?h-1:1,pointHoverRadius:y-1,spanGaps:!0,pointStyle:"line"}]},options:{responsive:!0,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"bottom",labels:{padding:16,usePointStyle:!0,pointStyleWidth:30,color:"#64748b",font:{size:12},generateLabels:o=>o.data.datasets.map((r,x)=>({text:r.label??"",strokeStyle:r.borderColor,fillStyle:"transparent",lineDash:r.borderDash??[],lineWidth:2,pointStyle:"line",hidden:!o.isDatasetVisible(x),datasetIndex:x}))}},tooltip:{backgroundColor:"#1B1F3B",titleFont:{weight:"bold"},padding:12,cornerRadius:8,callbacks:{label:o=>{let r=o.parsed.y??0;if(o.datasetIndex===2){let x=Math.floor(r),E=Math.round((r-x)*60);return` Allure : ${x}:${E.toString().padStart(2,"0")} /km`}return o.datasetIndex===1?` ${r} activit\xE9s`:` ${r} km`}}}},scales:{y:{type:"linear",position:"left",beginAtZero:!0,title:{display:!0,text:"km",color:"#3b82f6"},grid:{color:"#f1f5f9"},ticks:{color:"#3b82f6"}},y1:{type:"linear",position:"right",beginAtZero:!0,title:{display:!0,text:"Activit\xE9s",color:"#f97316"},grid:{drawOnChartArea:!1},ticks:{color:"#f97316"}},y2:{type:"linear",position:"right",reverse:!0,title:{display:!1},grid:{drawOnChartArea:!1},ticks:{display:!1}},x:{grid:{display:!1},ticks:{color:"#94a3b8"}}}}})}static \u0275fac=function(t){return new(t||p)};static \u0275cmp=O({type:p,selectors:[["app-progression"]],viewQuery:function(t,s){t&1&&K(s.progressionCanvas,at,5),t&2&&Q()},decls:5,vars:2,consts:[["progressionChart",""],[1,"max-w-7xl","mx-auto","px-6","py-8"],[1,"text-3xl","font-bold","text-slate-800","tracking-tight","mb-8"],[1,"text-center","py-16"],[1,"inline-block","h-10","w-10","animate-spin","rounded-full","border-4","border-strava","border-r-transparent"],[1,"mt-3","text-slate-400","font-medium"],[1,"bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-sm","border","border-slate-200/60","p-6","hover:shadow-md","transition-shadow","duration-300"],[1,"text-base","font-semibold","text-slate-700","mb-4"],[1,"mt-8"],[1,"text-xl","font-bold","text-slate-800","tracking-tight","mb-4"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4"],[1,"bg-gradient-to-br","from-blue-500","to-indigo-600","rounded-2xl","shadow-lg","shadow-blue-500/20","p-5","text-white"],[1,"text-xs","uppercase","tracking-wider","opacity-80","font-semibold"],[1,"text-3xl","font-extrabold","mt-2"],[1,"text-base","font-medium","opacity-80"],[1,"bg-gradient-to-br","from-emerald-500","to-teal-600","rounded-2xl","shadow-lg","shadow-emerald-500/20","p-5","text-white"],[1,"bg-gradient-to-br","from-violet-500","to-purple-600","rounded-2xl","shadow-lg","shadow-violet-500/20","p-5","text-white"],[1,"bg-gradient-to-br","from-orange-500","to-red-500","rounded-2xl","shadow-lg","shadow-orange-500/20","p-5","text-white"],[1,"text-xs","opacity-70","mt-1"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"group","bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-sm","border","border-slate-200/60","p-5","hover:shadow-md","hover:border-strava/30","transition-all","duration-300",3,"routerLink","queryParams","title"],[1,"flex","items-start","gap-4"],[1,"text-2xl"],[1,"min-w-0","flex-1"],[1,"text-xs","font-semibold","text-slate-400","uppercase","tracking-wider"],[1,"text-2xl","font-extrabold","text-slate-800","mt-1"],[1,"text-sm","text-slate-500","mt-1","truncate","group-hover:text-strava","transition-colors"],[1,"text-xs","text-slate-400","mt-0.5"]],template:function(t,s){t&1&&(l(0,"div",1)(1,"h1",2),u(2,"Progression"),d(),I(3,rt,4,0,"div",3),I(4,ct,7,2),d()),t&2&&(f(3),R(s.strava.loading()?3:-1),f(),R(s.strava.loading()?-1:4))},dependencies:[G],encapsulation:2})};export{et as Progression};
